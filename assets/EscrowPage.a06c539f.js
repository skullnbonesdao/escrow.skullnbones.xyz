import{Q as E}from"./QToggle.e5ace0d1.js";import{Q as R}from"./QPage.750c5927.js";import{_ as P,Q as N,a as W,b as F,c as H,d as A}from"./EscrowTableCards.3632ef8e.js";import{bZ as z,ah as D,aF as x,c0 as S,aC as j,au as M,cn as K,J as p,bs as L,aX as O,co as _,cp as T,b1 as v,ak as G,as as t,bx as o,ck as V,al as l,a1 as k,V as f,cd as q,ar as J,cq as C,bz as I,bT as B,ai as h,cr as X}from"./index.42130bcd.js";import{Q as $}from"./waitForTransactionConfirmation.95ac4748.js";import{Q as Z}from"./QCard.34d47514.js";import"./rtl.fba09913.js";var w=z({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(s,{slots:c}){const r=j(),i=D(()=>"q-td"+(s.autoWidth===!0?" q-table--col-auto-width":"")+(s.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(s.props===void 0)return x("td",{class:i.value},S(c.default));const m=r.vnode.key,d=(s.props.colsMap!==void 0?s.props.colsMap[m]:null)||s.props.col;if(d===void 0)return;const{row:g}=s.props;return x("td",{class:i.value+d.__tdClass(g),style:d.__tdStyle(g)},S(c.default))}}}),y=z({name:"QTr",props:{props:Object,noHover:Boolean},setup(s,{slots:c}){const r=D(()=>"q-tr"+(s.props===void 0||s.props.header===!0?"":" "+s.props.__trClass)+(s.noHover===!0?" q-tr--no-hover":""));return()=>x("tr",{class:r.value},S(c.default))}});const Y={class:"q-pa-md"},ee={class:"row items-center"},te={class:"col text-right"},ae={class:"row items-center"},oe={class:"col text-center"},se=["src"],le={style:{"font-size":"10px"}},ne={class:"col text-center"},re=["src"],ie={style:{"font-size":"10px"}},ce={class:"row q-gutter-x-sm"},de={class:"col"},ue=M({__name:"EscrowTable",props:["title","escrow_filter"],setup(s){const c=s;K();let r=p([]);const i=p([]),m=p([]),d=p([]);L(()=>_().is_initialized,async()=>{await g()}),O(async()=>{_().is_initialized&&await g()});async function g(){const{pg_escrow:b}=X(),n=(await b.value.account.escrow.all()).filter(e=>e.account.tokensDepositRemaining.toNumber()>0);switch(c.escrow_filter){case"p2p":console.log(n),r.value=n.filter(e=>e.account.recipient.toString()!=T.toString());break;case"deals":r.value=n.filter(e=>e.account.onlyWhitelist==!0);break;default:r.value=r.value=n.filter(e=>e.account.recipient.toString()==T.toString()&&e.account.onlyWhitelist!=!0);break}i.value=[],m.value=r.value.flatMap(e=>!1),d.value=r.value.flatMap(e=>!1)}const Q=p({page:1}),U=p([{name:"buying",label:"Buying",align:"left"},{name:"between",label:"",align:"left"},{name:"selling",label:"Selling"},{name:"price",label:"Price"},{name:"take",label:""}]);return(b,n)=>(v(),G("div",Y,[t(H,{flat:"",bordered:"",title:c.title,rows:f(r),columns:U.value,"row-key":"name",filter:b.filter,pagination:Q.value,"onUpdate:pagination":n[3]||(n[3]=e=>Q.value=e)},{"top-right":o(()=>[t($,{borderless:"",dense:"",debounce:"300",modelValue:b.filter,"onUpdate:modelValue":n[0]||(n[0]=e=>b.filter=e),placeholder:"Search"},{append:o(()=>[t(V,{name:"search"})]),_:1},8,["modelValue"])]),body:o(e=>[t(y,{props:e},{default:o(()=>[t(w,{key:"buying",props:e,class:"text-right"},{default:o(()=>[l("div",ee,[l("b",te,k((e.row.account.tokensDepositRemaining*Math.pow(10,-f(_)().token_list.find(a=>a.address==e.row.account.depositToken.toString()).decimals)).toFixed(2)),1)])]),_:2},1032,["props"]),t(w,{key:"between",props:e},{default:o(()=>[l("div",ae,[l("div",oe,[t(q,{size:"md"},{default:o(()=>{var a;return[l("img",{src:((a=f(_)().token_list.find(u=>u.address==e.row.account.depositToken.toString()))==null?void 0:a.logoURI)??"unknown.png"},null,8,se)]}),_:2},1024),l("p",le,k(f(_)().token_list.find(a=>a.address==e.row.account.depositToken.toString()).symbol),1)]),t(V,{class:"col",name:"arrow_forward"}),l("div",ne,[t(q,{size:"md"},{default:o(()=>{var a;return[l("img",{src:((a=f(_)().token_list.find(u=>u.address==e.row.account.requestToken.toString()))==null?void 0:a.logoURI)??"unknown.png"},null,8,re)]}),_:2},1024),l("p",ie,k(f(_)().token_list.find(a=>a.address==e.row.account.requestToken.toString()).symbol),1)])])]),_:2},1032,["props"]),t(w,{key:"selling",props:e,class:"text-right"},{default:o(()=>[l("b",null,k((e.row.account.tokensDepositRemaining*Math.pow(10,-f(_)().token_list.find(a=>a.address==e.row.account.depositToken.toString()).decimals)*e.row.account.price).toFixed(2)),1)]),_:2},1032,["props"]),t(w,{key:"price",props:e},{default:o(()=>[J(k(e.row.account.price),1)]),_:2},1032,["props"]),t(w,{key:"take",props:e},{default:o(()=>[t(C,{flat:"",color:"primary",icon:"info",onClick:a=>m.value[e.rowIndex]=!m.value[e.rowIndex]},null,8,["onClick"]),t(C,{flat:"",color:"primary",icon:d.value[e.rowIndex]?"remove":"send",onClick:a=>d.value[e.rowIndex]=!d.value[e.rowIndex]},null,8,["icon","onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"]),I(t(y,{props:e},{default:o(()=>[t(w,{colspan:"100%"},{default:o(()=>[e.row.account.allowPartialFill?(v(),h(Z,{key:1,bordered:"",class:"col bg-secondary q-pa-sm",flat:""},{default:o(()=>{var a;return[l("div",ce,[l("div",de,[t($,{dense:"",class:"col",standout:"",square:"",modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=u=>i.value=u),label:"Amount",type:"number"},null,8,["modelValue"]),t(N,{class:"q-px-sm q-pt-sm",dense:"",modelValue:i.value,"onUpdate:modelValue":n[2]||(n[2]=u=>i.value=u),min:0,max:e.row.account.tokensDepositRemaining*Math.pow(10,-((a=f(_)().token_list.find(u=>u.address==e.row.account.depositToken.toString()))==null?void 0:a.decimals)),color:"blue","track-size":"10px","thumb-color":"black",markers:""},null,8,["modelValue","max"])]),t(W,{escrow_address:e.row.publicKey,exchange_amount:i.value},null,8,["escrow_address","exchange_amount"])])]}),_:2},1024)):(v(),h(P,{key:0,class:"full-width",escrow_address:e.row.publicKey},null,8,["escrow_address"]))]),_:2},1024)]),_:2},1032,["props"]),[[B,d.value[e.rowIndex]]]),I(t(y,{props:e},{default:o(()=>[t(w,{colspan:"100%"},{default:o(()=>[t(F,{escrow:e.row},null,8,["escrow"])]),_:2},1024)]),_:2},1032,["props"]),[[B,m.value[e.rowIndex]]])]),_:1},8,["title","rows","columns","filter","pagination"])]))}}),_e={class:"row"},me=l("div",{class:"col"},null,-1),he=M({__name:"EscrowPage",setup(s){const c=p(!0);return(r,i)=>(v(),h(R,null,{default:o(()=>[l("div",_e,[me,t(E,{modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=m=>c.value=m),label:"Table/Card"},null,8,["modelValue"])]),c.value?(v(),h(ue,{key:0,title:"Public Escrows"})):(v(),h(A,{key:1,title:"Public Escrows"}))]),_:1}))}});export{he as default};
